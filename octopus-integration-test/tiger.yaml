ports:
  identity: ${free.port.1}
  client: ${free.port.2}
  shopping: ${free.port.5}
  proxyMgmt: 9090 #${free.port.3}
  proxyPort: 9191 #${free.port.4}

tigerProxy:
  activateRbelEndpoint: true
  skipTrafficEndpointsSubscription: true
  trafficEndpoints:
    - http://localhost:${tiger.ports.proxyMgmt}

servers:
  octopusIdentityServer:
    type: externalJar
    source:
      - local:../octopus-identity-service/target/octopus-identity-service-1.0-SNAPSHOT.jar
    externalJarOptions:
      options:
        - -Dhttp.proxyHost=127.0.0.1
        - -Dhttp.proxyPort=${tiger.ports.proxyPort}
      arguments:
        - --server.port=${tiger.ports.identity}
        - --services.shopping=http://octopusShoppingServer
      healthcheck: http://localhost:${tiger.ports.identity}/status

  octopusShoppingServer:
    type: externalJar
    source:
      - local:../octopus-shopping-service/target/octopus-shopping-service-1.0-SNAPSHOT.jar
    externalJarOptions:
      options:
        - -Dhttp.proxyHost=127.0.0.1
        - -Dhttp.proxyPort=${tiger.ports.proxyPort}
      arguments:
        - --server.port = ${tiger.ports.shopping}
        - --services.identity=http://octopusIdentityServer
      healthcheck: http://localhost:${tiger.ports.shopping}/inventory/status

  octopusClient:
    type: externalJar
    source:
      - local:../octopus-example-client/target/octopus-example-client-1.0-SNAPSHOT.jar
    externalJarOptions:
      options:
        - -Dhttp.proxyHost=127.0.0.1
        - -Dhttp.proxyPort=${tiger.ports.proxyPort}
      arguments:
        - --server.port=${tiger.ports.client}
        - --services.identity=http://octopusIdentityServer
        - --services.shopping=http://octopusShoppingServer
      healthcheck: http://localhost:${tiger.ports.client}/testdriver/status

  remoteTigerProxy:
    type: tigerProxy
    tigerProxyCfg:
      serverPort: ${tiger.ports.proxyMgmt}
      proxyCfg:
        port: ${tiger.ports.proxyPort}
        proxyRoutes:
          - from: http://octopusIdentityServer
            to: http://localhost:${tiger.ports.identity}
          - from: http://octopusShoppingServer
            to: http://localhost:${tiger.ports.shopping}
          - from: http://octopusClient
            to: http://localhost:${tiger.ports.client}
